

crimes(Oâ€˜yinchi tomonidan sodir etilgan jinoyatlar roâ€˜yxati.ğŸš”ğŸ”«ğŸƒâ€â™‚ï¸):
    id                      â†’ Jinoyat unikal identifikatori (primary key). Har bir jinoyatga avtomatik ID beriladi.
    player_id               â†’ Oâ€˜yinchining players jadvalidagi ID si. Ushbu jinoyat qaysi oâ€˜yinchi tomonidan sodir etilganini bildiradi. Agar oâ€˜yinchi oâ€˜chirilsa, uning barcha jinoyatlari ham oâ€˜chadi (ON DELETE CASCADE).
    crime_type              â†’ Jinoyat turi. Quyidagi qiymatlardan biri boâ€˜lishi kerak:
            Robbery         â†’ Oâ€˜gâ€˜irlik (doâ€˜kon yoki bankdan pul oâ€˜gâ€˜irlash)
            Murder          â†’ Qotillik (NPC yoki boshqa oâ€˜yinchini oâ€˜ldirish)
            Car Theft       â†’ Avtomobil oâ€˜gâ€˜irlash
            Drug Deal       â†’ Narkotik savdosi
    wanted_level_increase   â†’ Jinoyatdan keyin yulduz darajasi ortishi (1 â†’ Eng yengil, 5 â†’ Eng ogâ€˜ir). Jinoyat qanchalik ogâ€˜ir boâ€˜lsa, politsiya qidiruvi shunchalik kuchayadi.
    police_response         â†’ Politsiya javobi. Quyidagi qiymatlardan biri boâ€˜lishi mumkin:
            Chase           â†’ Oddiy politsiya taâ€™qibi
            SWAT            â†’ Ogâ€˜ir qurollangan SWAT boâ€˜limi chaqiriladi
            FBI             â†’ Eng ogâ€˜ir jinoyatlar uchun FBI aralashadi
    crime_location          â†’ Jinoyat joyi. Jinoyat sodir etilgan joy (masalan, "Los Santos Bank", "Downtown Street").
    crime_time              â†’ Jinoyat sodir boâ€˜lgan vaqt. Ushbu jinoyat qachon amalga oshirilgani koâ€˜rsatiladi (default CURRENT_TIMESTAMP).



1-topshiriq:
    Jinoyatni roâ€˜yxatdan oâ€˜tkazish
    Tavsif:

        Jinoyatlarni roâ€˜yxatdan oâ€˜tkazish funksiyasini yaratish.

            log_crime(player_id, crime_type, wanted_level_increase) funksiyasini yozing. Bu funksiya player_id,
            crime_type, va wanted_level_increase ni qabul qiladi.
            crime_type (masalan, "Robbery", "Murder") asosida jinoyat turini crimes jadvaliga qoâ€˜shadi.
            Jinoyat turiga qarab, oâ€˜yinchining wanted_level qiymatini yangilaydi. Agar jinoyat Hard boâ€˜lsa,
            wanted_level 3 ga oshadi, Medium boâ€˜lsa 2 ga oshadi, Easy boâ€˜lsa 1 ga oshadi.
            Funksiya jinoyat roâ€˜yxatini toâ€˜ldirib, jinoyat vaqtini va oâ€˜yinchi bilan bogâ€˜liq boâ€˜lgan barcha kerakli maâ€™lumotlarni qaytarsin.


2-topshiriq:
    Oâ€˜yinchining jinoyat tarixini olish
    Tavsif:

        Oâ€˜yinchining jinoyat tarixini olish funktsiyasini yaratish.

        get_player_crimes(player_id) funksiyasini yozing. Bu funksiya player_id ni qabul qiladi va oâ€˜yinchining barcha jinoyatlarini qaytaradi.
        Funksiya crimes jadvalidan oâ€˜yinchiga tegishli jinoyatlarni olish va ular boâ€˜yicha maâ€™lumotlarni qaytarish kerak.
        Funksiya barcha jinoyatlar, jinoyat turi, politsiya javobi, va jinoyat vaqtini koâ€˜rsatishi kerak


3-topshiriq:
    Jinoyatlarni va ularning darajalarini koâ€˜rsatish
    Tavsif:

        Jinoyatlar boâ€˜yicha view yaratish.

        crime_summary nomli view yarating, unda quyidagi maâ€™lumotlar boâ€˜lsin:
        Oâ€˜yinchining username
        Jinoyat turi crime_type
        Oâ€˜yinchining wanted_level (jinoyat darajasi) va jinoyat uchun wanted_level_increase
        Jinoyat joyi crime_location


4-topshiriq:
    Oâ€˜yinchilar va jinoyatlariga oid koâ€˜rsatkichlar
    Tavsif:

        Oâ€˜yinchilarni va ularning jinoyatlarini koâ€˜rsatish.

        player_crime_status nomli view yarating, unda quyidagi maâ€™lumotlar boâ€˜lishi kerak:
        Oâ€˜yinchining username
        Jinoyat turini crime_type
        Jinoyat darajasi boâ€˜yicha wanted_level_increase
        Politsiya reaksiyasi boâ€˜yicha police_response

TRIGGER:
5-topshiriq:
    Jinoyat darajasining avtomatik yangilanishi
    Tavsif:

        Jinoyat amalga oshirilganda, oâ€˜yinchining wanted_level (jinoyat darajasi) avtomatik ravishda increase (ortib) borishi kerak.

        Trigger yarating, bu crimes jadvalidagi har bir yangi jinoyat yozuvi kiritilganda playerning wanted_level (jinoyat darajasi) ga wanted_level_increase qiymatini qoâ€˜shsin.


6-topshiriq:
    Oâ€˜yinchi jinoyat darajasi ortganda politsiya javobini yangilash
    Tavsif:

        Agar oâ€˜yinchining wanted_level (jinoyat darajasi) oshsa (masalan, 2 dan 3 ga oâ€˜tsa), police_response (politsiya reaktsiyasi) avtomatik ravishda "SWAT" ga oâ€˜zgartirilsin.

        Trigger yarating, bu players jadvalidagi wanted_level oâ€˜zgarishida, agar yangi qiymat 3 yoki undan yuqori boâ€˜lsa, police_response ustunini "SWAT" ga yangilasÄ±n.


       CREATE OR REPLACE FUNCTION product_count_category_trigger()





if new.wanted_level <> old.wanted_level then
    if new.wanted_level >= 3 then
        update crimes set police_response = 'SWAT' where player_id = crimes.player_id


RETURNS TRIGGER
LANGUAGE plpgsql
AS
$$
BEGIN
    IF old.wanted_level <> new.wanted_level THEN
        if  old.wanted_level < new.wanted_level
        UPDATE categories
        SET product_count = product_count + 1
        WHERE id = NEW.cat_id;  -- category_id oâ€˜rniga cat_id
        RETURN NEW;
    ELSIF TG_OP = 'DELETE' THEN
        UPDATE categories
        SET product_count = product_count - 1
        WHERE id = OLD.cat_id;  -- category_id oâ€˜rniga cat_id
        RETURN OLD;
    END IF;
END;
$$;

CREATE TRIGGER product_insert_trigger
AFTER update ON products
FOR EACH ROW
EXECUTE FUNCTION product_count_category_trigger();